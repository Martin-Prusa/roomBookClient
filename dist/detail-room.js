(()=>{"use strict";class e{#e="http://127.0.0.1:8080/roomBookingServer-1.0-SNAPSHOT/api";getRooms(){return fetch(this.#e+"/Rooms")}getRoom(e){return fetch(this.#e+"/Rooms/"+e)}createRoom(e){return fetch(this.#e+"/Rooms",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}updateRoom(e,t){return fetch(this.#e+`/Rooms/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}deleteRoom(e){return fetch(this.#e+"/Rooms/"+e,{method:"DELETE"})}createReservation(e,t){return fetch(this.#e+`/Rooms/${e}/Reservations`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}updateReservation(e,t,n){return fetch(this.#e+`/Rooms/${e}/Reservations/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})}deleteReservation(e,t){return fetch(this.#e+`/Rooms/${e}/Reservations/${t}`,{method:"DELETE"})}}window.onload=()=>{let t;const n=new URLSearchParams(window.location.search).get("id"),o=new e,r=document.querySelector("#title-box"),a=document.querySelector("#description-box"),i=document.querySelector("#price-box"),s=document.querySelector("#seats-box"),l=document.querySelector("#reservations-box");document.querySelector("#edit-button").addEventListener("click",(()=>{document.location.href=`./edit-room.html?id=${n}`})),document.querySelector("#delete-button").addEventListener("click",(()=>{o.deleteRoom(n).then((e=>{204===e.status&&(document.location.href="../index.html")}))}));const c=document.querySelector("#reservation-email"),d=document.querySelector("#reservation-first"),u=document.querySelector("#reservation-last"),m=document.querySelector("#reservation-from"),h=document.querySelector("#reservation-to"),v=document.querySelector("#reservation-error"),S=new bootstrap.Modal(document.querySelector("#reservation-modal")),p=document.querySelector("#open-modal"),y=document.querySelector("#reservation-button"),f=document.querySelector("#reservation-update-button");p.addEventListener("click",(()=>{S.show(),f.style.display="none",y.style.display="block",v.innerHTML="",c.value="",d.value="",u.value="",m.value="",h.value=""})),y.addEventListener("click",(()=>{try{o.createReservation(n,{email:c.value,firstName:d.value,lastName:u.value,from:new Date(m.value).toISOString().slice(0,-1),to:new Date(h.value).toISOString().slice(0,-1)}).then((e=>{200===e.status?(S.hide(),T()):v.innerHTML="Nelze zarezervovat. Zkontrolujte zadané údaje."})).catch((e=>v.innerHTML="Nelze zarezervovat. Chyba serveru."))}catch(e){v.innerHTML="Nelze zarezervovat. Zkontrolujte zadané údaje."}})),f.addEventListener("click",(()=>{o.updateReservation(n,t,{email:c.value,firstName:d.value,lastName:u.value,from:new Date(m.value).toISOString().slice(0,-1),to:new Date(h.value).toISOString().slice(0,-1)}).then((e=>{200===e.status?(S.hide(),T()):v.innerHTML="Nelze upravit. Zkontrolujte zadané údaje."})).catch((e=>v.innerHTML="Nelze upravit. Chyba serveru."))}));const T=()=>{l.innerHTML="",o.getRoom(n).then((e=>{200===e.status?e.json().then((e=>{r.innerHTML=e.title,a.innerHTML=e.description,i.innerHTML=e.price,s.innerHTML=e.seats,e.reservations.forEach((e=>{const r=document.createElement("tr"),a=new Date(e.from);a.setMinutes(a.getMinutes()-a.getTimezoneOffset());const i=new Date(e.to);i.setMinutes(i.getMinutes()-i.getTimezoneOffset()),r.innerHTML=`\n                        <td>${e.email}</td>\n                        <td>${e.firstName}</td>\n                        <td>${e.lastName}</td>\n                        <td>${a.toLocaleDateString()} ${a.toLocaleTimeString()}</td>\n                        <td>${i.toLocaleDateString()} ${i.toLocaleTimeString()}</td>\n                `;const s=document.createElement("td");s.className="pointer",s.innerHTML='<i class="fa-solid fa-trash-can"></i>',s.addEventListener("click",(()=>{o.deleteReservation(n,e.id).then((e=>{204===e.status&&T()}))}));const p=document.createElement("td");p.className="pointer",p.innerHTML='<i class="fa-solid fa-pen-clip"></i>',p.addEventListener("click",(()=>{S.show(),t=e.id,f.style.display="block",y.style.display="none",v.innerHTML="",c.value=e.email,d.value=e.firstName,u.value=e.lastName;let n=new Date(e.from);n.setMinutes(n.getMinutes()-2*n.getTimezoneOffset()),m.value=n.toISOString().slice(0,16);let o=new Date(e.to);o.setMinutes(o.getMinutes()-2*o.getTimezoneOffset()),h.value=o.toISOString().slice(0,16)})),r.appendChild(s),r.appendChild(p),l.appendChild(r)}))})).catch((e=>document.location.href="../index.html")):document.location.href="../index.html"}))};T()}})();